<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="Ezequiel Tavella ">
<meta name="description"
    content="WeLiveSecurity es un blog sobre seguridad informatica administrado por la comunidad de analistas de seguridad que trabajan para ESET, si el famoso antivirus!
Cada cierto tiempo en este blog presentan retos en los que cualquiera puede participar, divertirse un rato, aprender y ganar algun premio. Hoy presentaron el reto 29 el cual se basa en buscar un flag.
Entramos al post del blog y nos encontramos con un Zip para descargar, pero nos avisan que el mismo tiene una contraseña la cual podemos encontrar si es que logramos resolver el problema en la siguiente imagen:" />
<meta name="keywords" content="computers, network, hacking, security, research" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://ezequieltbh.me/posts/2015/03/es-desaf%C3%ADo-eset-29-write-up/" />


<title>
    
    [ES] Desafío ESET 29: Write Up :: EzequielTBH Blog&#39;s 
    
</title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://ezequieltbh.me/main.min.91687bbfc139d7ff1a244bb6d7324425f9c4f424eaaad242b478e3b3cf56396a.css">



<link rel="apple-touch-icon" sizes="180x180" href="https://ezequieltbh.me/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://ezequieltbh.me/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://ezequieltbh.me/favicon-16x16.png">
<link rel="manifest" href="https://ezequieltbh.me/site.webmanifest">
<link rel="mask-icon" href="https://ezequieltbh.me/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="https://ezequieltbh.me/favicon.ico">
<meta name="theme-color" content="#252627">
<meta itemprop="name" content="[ES] Desafío ESET 29: Write Up">
<meta itemprop="description" content="WeLiveSecurity es un blog sobre seguridad informatica administrado por la comunidad de analistas de seguridad que trabajan para ESET, si el famoso antivirus!
Cada cierto tiempo en este blog presentan retos en los que cualquiera puede participar, divertirse un rato, aprender y ganar algun premio. Hoy presentaron el reto 29 el cual se basa en buscar un flag.
Entramos al post del blog y nos encontramos con un Zip para descargar, pero nos avisan que el mismo tiene una contraseña la cual podemos encontrar si es que logramos resolver el problema en la siguiente imagen:">


<meta itemprop="datePublished" content="2015-03-20T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2015-03-20T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="651">



<meta itemprop="keywords" content="CTF,ESET," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ezequieltbh.me"/>

<meta name="twitter:title" content="[ES] Desafío ESET 29: Write Up"/>
<meta name="twitter:description" content="WeLiveSecurity es un blog sobre seguridad informatica administrado por la comunidad de analistas de seguridad que trabajan para ESET, si el famoso antivirus!
Cada cierto tiempo en este blog presentan retos en los que cualquiera puede participar, divertirse un rato, aprender y ganar algun premio. Hoy presentaron el reto 29 el cual se basa en buscar un flag.
Entramos al post del blog y nos encontramos con un Zip para descargar, pero nos avisan que el mismo tiene una contraseña la cual podemos encontrar si es que logramos resolver el problema en la siguiente imagen:"/>




<meta property="article:published_time" content="2015-03-20 00:00:00 &#43;0000 &#43;0000" />







    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://ezequieltbh.me/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text"># </span>
            <span class="logo__cursor"></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://ezequieltbh.me/about/">About</a></li><li><a href="https://ezequieltbh.me/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>4 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title"><a href="https://ezequieltbh.me/posts/2015/03/es-desaf%C3%ADo-eset-29-write-up/">[ES] Desafío ESET 29: Write Up</a></h1>

            

            <div class="post-content">
                <p><a href="http://www.welivesecurity.com/" target="_blank">WeLiveSecurity</a> es un blog sobre seguridad informatica administrado por la comunidad de analistas de seguridad que trabajan para ESET, si el famoso antivirus!</p>

<p>Cada cierto tiempo en este blog presentan retos en los que cualquiera puede participar, divertirse un rato, aprender y ganar algun premio. Hoy presentaron el reto 29 el cual se basa en buscar un flag.</p>

<p>Entramos al <a href="https://www.welivesecurity.com/la-es/2015/03/20/desafio-eset-29-encuentra-accion-maliciosa/" target="_blank">post</a> del blog y nos encontramos con un <a href="http://www.welivesecurity.com/wp-content/uploads/2015/03/Desafio_-_29.zip" target="_blank">Zip</a> para descargar, pero nos avisan que el mismo tiene una contraseña la cual podemos encontrar si es que logramos resolver el problema en la siguiente imagen:</p>

<p><img src="https://ezequieltbh.me/images/posts/desafio-eset-29/CodigoQR2.png" alt="Codigo-Qr" /></p>

<p>Tenemos una imagen QR, asi que volvemos a utilizar nuestra herramienta online para decodificar su contenido y nos encontramos con:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Textfile" data-lang="Textfile">RG9Nb3Jl==</code></pre></div>
<p>Debido a los dos signos <strong>&rdquo;=&rdquo;</strong> del final, nos damos cuenta rapidamente que se trata de un string en <strong>base 64</strong>, decodificandolo terminamos obteniendo la clave:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Textfile" data-lang="Textfile">DoMore</code></pre></div>
<p>En este punto tenemos una carpeta llamada <strong>&ldquo;Desafio_-_29&rdquo;</strong> la cual contiene un archivo llamado <strong>&ldquo;Desafio__29.exe&rdquo;</strong> asi que vamos a investigar un poco ese ejecutable.</p>

<p>El primer paso es extraer todos los strings que este contiene por lo que utilizando la herramienta <strong>&ldquo;strings.exe&rdquo;</strong> de <strong>SysInternals</strong> terminamos obteniendo entre otras cosas</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Textfile" data-lang="Textfile">8fda2e04=&#34;Archivo auto-extraible WinRAR&#34;</code></pre></div>
<p>Ok al parecer tenemos un ejecutable que en realidad es un un archivo <strong>SFX</strong> generado con <strong>WinRAR</strong>, el siguiente paso es abrirlo y ver cuales son sus ordenes de extraccion junto con su contenido.</p>

<p><img src="https://ezequieltbh.me/images/posts/desafio-eset-29/2015-03-20 18_25_28-Desafio__29.exe.jpg" alt="File-And-Comment" /></p>

<p>Adentro de este <strong>SFX</strong> tenemos un archivo sin extension y un comentario que indica que se realizara la extraccion silenciosamente <strong>(Silent = 1)</strong> por lo que no veremos ninguna ventana al momento de realizarse la descompresion, tambien vemos que la ruta donde se hara la misma es en <strong>&ldquo;C:\WINDOWS\Temp&rdquo;</strong>.</p>

<p>Ahora podemos ejecutar el exe con seguridad de que no se nos paso nada, y buscar ese archivo <strong>&ldquo;Desafio__29&rdquo;</strong> para identificar su contenido gracias a sus primeros bytes, los cuales son:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Textfile" data-lang="Textfile">d0 cf 11</code></pre></div>
<p>Un poco de Google y nos encontramos con la respuesta: <strong>Microsoft Office Document</strong>.</p>

<p>Renombramos el archivo a <strong>&ldquo;Desafio__29.doc&rdquo;</strong> por probar y acertamos&hellip;</p>

<p><img src="https://ezequieltbh.me/images/posts/desafio-eset-29/2015-03-20 18_40_56-Desafio__29.doc [Modo de compatibilidad] - Word.jpg" alt="Altas-Cartas" /></p>

<p>A simple vista no hay ningun flag, pero ahora mismo tenemos un archivo <strong>Word</strong> y un reto de una compania de anti malware, donde uno puede guardar malware en un archivo de <strong>Office</strong>?&hellip;</p>

<p>En los Macros!!</p>

<p><img src="https://ezequieltbh.me/images/posts/desafio-eset-29/2015-03-20 18_45_41-Microsoft Visual Basic para Aplicaciones - Desafio__29 .jpg" alt="Visual-Basic-Macro" /></p>

<p>Vamos a analizar un poco este codigo:</p>

<p>En el principio (el cual no esta en la imagen), podemos observar como se declaran las funciones <strong>&ldquo;CreateThread&rdquo;</strong>, <strong>&ldquo;VirtualAlloc&rdquo;</strong>, <strong>&ldquo;RtlMoveMemory&rdquo;</strong> lo cual nos hace sospechar de que en algun lugar hay codigo ejecutable que sera cargado en memoria gracias al uso de estas funciones anteriormente mencionadas.</p>

<p>Si nos vamos al final del codigo podemos ver <strong>&ldquo;Workbook_Open()&rdquo;</strong>, este es un evento que se ejecuta al iniciar el documento siempre y cuando los macros esten activados, el mismo como se puede observar llama a la funcion <strong>Auto_Open</strong>.</p>

<p>Analizando <strong>Auto_Open</strong>:</p>

<ul>
<li><p><strong>&ldquo;Array&rdquo;</strong> guarda el codigo ejecutable, codificado en decimal, que sospechabamos que habia.</p></li>

<li><p><strong>VirtualAlloc</strong> reserva memoria con el tamaño justo (gracias a <strong>UBound</strong>) para almacenar el <strong>Array</strong>.</p></li>

<li><p><strong>RtlMoveMemory</strong> realiza movimientos de memoria para colocar la shellcode en memoria de manera correcta, toma como destino a <strong>&ldquo;Ffhzpyadi + Spcwl&rdquo;</strong> y como origen a <strong>Xosacrosk</strong>, siempre realizando movimientos de 1 byte. Por lo que tenemos basicamente en este bucle, un decoder!</p></li>

<li><p><strong>CreateThread</strong> crea un nuevo hilo de ejecucion ejecutando ese codigo.</p></li>
</ul>

<p>En este punto convencido de que el flag debe estar en ese shellcode, lo que voy a hacer es cargar en memoria ese shellcode y localizarlo a traves de <strong>&ldquo;Ffhzpyadi&rdquo;</strong>.</p>

<p>Para esto agrego un punto de inspeccion a la variable <strong>&ldquo;Ffhzpyadi&rdquo;</strong> y ejecuto el codigo hasta la linea de <strong>CreateThread</strong>. Ahora mismo el shellcode deberia estar ya en memoria y para ubicarlo miro el valor de la variable <strong>&ldquo;Ffhzpyadi&rdquo;</strong> el cual es <strong>&ldquo;193003520&rdquo;</strong>, pasando a hexadecimal obtenemos <strong>&ldquo;0xb810000&rdquo;</strong>.</p>

<p>Abrimos <strong>Inmunity Debugger</strong> y nos vamos a ver la direccion de memoria que obtuvimos antes, al final de todo nos encontramos con el <strong>FLAG!</strong></p>

<p><strong>Flag_is_EnjoySaferTechnology</strong></p>

<p>Y hasta aca llega el reto!</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://ezequieltbh.me/tags/ctf">CTF</a></span><span class="tag"><a href="https://ezequieltbh.me/tags/eset">ESET</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>651 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2015-03-19 21:00 -0300</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h"></span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="https://ezequieltbh.me/posts/2015/08/es-cybercamp-2015-ctf-criptografia-challenge/">
                                <span class="button__icon">←</span>
                                <span class="button__text">[ES] Cybercamp 2015 CTF: Criptografia challenge</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="https://ezequieltbh.me/posts/2015/03/es-ctf-infosecinstitute-parte-3/">
                                <span class="button__text">[ES] CTF InfosecInstitute - Parte 3</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2019</span>
            
                <span><a href="https://ezequieltbh.me">Ezequiel Tavella</a></span>
            
            <span>All rights reserved.</span>
            <span> <a href="https://ezequieltbh.me/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">

        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">rhazdon</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://ezequieltbh.me/bundle.min.cf7871ed49474a80ed457154d24e61f7881adbe0f9384951a74ac46b688a39a4dbfa68bc6d37baeb058186de354ead3487d4ee7f083ea4cba860c48600b694f3.js" integrity="sha512-z3hx7UlHSoDtRXFU0k5h94ga2&#43;D5OElRp0rEa2iKOaTb&#43;mi8bTe66wWBht41Tq00h9Tufwg&#43;pMuoYMSGALaU8w=="></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-137782393-1', 'auto');
        ga('send', 'pageview');
    </script>



    </body>
</html>
